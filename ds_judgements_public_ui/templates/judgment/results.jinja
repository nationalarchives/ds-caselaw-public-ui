{% extends "layouts/search_results.jinja" %}
{% from "components/alert.jinja" import alert %}
{% from "components/pagination.jinja" import pagination %}
{% from "components/documents_table.jinja" import document_table_row, document_table_cell, documents_table %}
{% block content_body %}
  {% if show_no_exact_ncn_warning %}
    {% call alert() %}
      <p>There is no judgment with the Neutral Citation of {{ query }} in our database.</p>
    {% endcall %}
  {% endif %}
  {% if requires_from_warning %}
    {% call alert() %}
      <p>
        {{ date_warning }} <a href="{{ url("about_this_service") }}#section-coverage">Find out what records are available on this service.</a>
      </p>
    {% endcall %}
  {% endif %}
  {% if total > 0 %}
    <div class="results__result-header-container">
      <div class="results__result-header">
        <p class="results__results-intro">{{ total|intcomma }} documents found</p>
      </div>
      {% include "includes/atom_feed_button.jinja" %}
      {% include "includes/results_controls.jinja" %}
    </div>
    <div class="results__result-list-container">
      <h2>Results listing</h2>
      {% call documents_table(headings=["Neutral citation", "Handed down"]) %}
        {% for judgment in search_results %}
          {% call document_table_row() %}
            {% call document_table_cell(variant="details") %}
              {% call link(href=url("detail", judgment.slug)) %}
                {{ judgment.name }}
              {% endcall %}
              {{ judgment.court.name }}
              {% if judgment|show_matches(query) %}
                <div>
                  {% autoescape off %}
                    {{ judgment.matches }}
                  {% endautoescape %}
                </div>
              {% endif %}
            {% endcall %}
            {% call document_table_cell(variant="text", label="Neutral citation") %}
              {{ judgment.neutral_citation | default("&mdash;", true) | safe }}
            {% endcall %}
            {% call document_table_cell(variant="text", label="Handed down") %}
              {{ formatdate(judgment.date) }}
            {% endcall %}
          {% endcall %}
        {% endfor %}
      {% endcall %}
    </div>
    {% if not paginator.has_next_page %}
      {% call alert(title="End of results") %}
        {% include "includes/no_results_message.jinja" %}
      {% endcall %}
    {% endif %}
    {% if paginator.show_pagination %}
      {% set base_qs = request.path ~ "?" ~ (query_string ~ "&" if query_string else "") %}
      {% set items = [] %}
      {% if paginator.show_first_page %}
        {% set _ = items.append({
                  "number": 1,
                  "href": base_qs ~ "page=1"
                }) %}
      {% endif %}
      {% if paginator.show_first_page_divider %}
        {% set _ = items.append({"ellipsis": true}) %}
      {% endif %}
      {% for page in paginator.page_range %}
        {% if page == paginator.current_page %}
          {% set _ = items.append({
                      "number": page,
                      "href": base_qs ~ "page=" ~ page,
                      "current": true
                    }) %}
        {% else %}
          {% set _ = items.append({
                      "number": page,
                      "href": base_qs ~ "page=" ~ page
                    }) %}
        {% endif %}
      {% endfor %}
      {% if paginator.show_last_page_divider %}
        {% set _ = items.append({"ellipsis": true}) %}
      {% endif %}
      {% if paginator.show_last_page %}
        {% set _ = items.append({
                  "number": paginator.number_of_pages,
                  "href": base_qs ~ "page=" ~ paginator.number_of_pages
                }) %}
      {% endif %}
      {{ pagination({
            "previous": {
            "html": "Previous",
            "href":  (base_qs ~ "page=" ~ paginator.prev_page) if paginator.has_prev_page else (base_qs ~ "page=" ~ paginator.current_page)
      },
      "items": items,
      "next": {
      "html": "Next",
      "href": (base_qs ~ "page=" ~ paginator.next_page) if paginator.has_next_page else (base_qs ~ "page=" ~ paginator.current_page)
      }
      }) }}
    {% endif %}
  {% else %}
    {% call alert(title="No matching results have been found") %}
      {% include "includes/no_results_message.jinja" %}
    {% endcall %}
  {% endif %}
{% endblock content_body %}
